{% extends 'base.html' %}
{% load static %}
{% block title %}
    <title>Bosh Sahifa </title>
{% endblock title %}
{% block css %}
    <link href="{% static 'assets/css/scrollspyNav.css'%}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/forms/theme-checkbox-radio.css'%}">
    <link href="{% static 'assets/css/tables/table-basic.css'%}" rel="stylesheet" type="text/css" />
    <link href="{% static 'plugins/flatpickr/flatpickr.css'%}" rel="stylesheet" type="text/css">
    <link href="{% static 'plugins/noUiSlider/nouislider.min.css'%}" rel="stylesheet" type="text/css">
    <link href="{% static 'plugins/flatpickr/custom-flatpickr.css'%}" rel="stylesheet" type="text/css">
    <style>
        label {
            color: black !important;
            font-weight: bold;
        }
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .section-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-right: 10px;
        }
        .section-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .subsection {
            margin-left: 30px;
            margin-bottom: 8px;
        }
        .subsection-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .subsection-item input {
            margin-right: 8px;
            transform: scale(1.1);
        }
        .divider {
            border-top: 1px solid #e0e0e0;
            margin: 15px 0;
        }
        .form-container {
            padding: 20px;
            background: #fff;
            border-radius: 6px;
        }
        input[type="checkbox"] {
            cursor: pointer;
        }
    </style>
{% endblock css %}

{% block content %}
    <div id="content" class="main-content">
        <div class="container-fluid">
            <div class="row layout-top-spacing">
                <div class="col-lg-12">
                    <div class="statbox widget box box-shadow" style="width: 100%;">
                        <div class="widget-content widget-content-area form-container" style="width: 100%;">
                            <form method="post" style="width: 100%;">
                                {% csrf_token %}
                                
                                <!-- Dashboard Section -->
                                <div class="section-header" style="width: 100%;">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'dashboard')">
                                    <div class="section-title">Dashboard</div>
                                </div>
                                <div class="subsection" id="dashboard">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_bussines" {% if use.is_bussines %} checked {% endif %}>
                                        <label>Bussines Tahlili</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_filial_boshkaruvi" {% if use.is_filial_boshkaruvi %} checked {% endif %}>
                                        <label>Filiallar Boshqaruvi</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Sotuvlar Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'sotuvlar')">
                                    <div class="section-title">Sotuvlar</div>
                                </div>
                                <div class="subsection" id="sotuvlar">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_bugungi_sotuvlar" {% if use.is_bugungi_sotuvlar %} checked {% endif %}>
                                        <label>Sotuv bo'limi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_buyurtmalar" {% if use.is_buyurtmalar %} checked {% endif %}>
                                        <label>Buyurtmalar</label>
                                    </div>
                                    <!-- <div class="subsection-item">
                                        <input type="checkbox" name="is_savdo" {% if use.is_savdo %} checked {% endif %}>
                                        <label>Savdo</label>
                                    </div> -->
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_b2b_savdo" {% if use.is_b2b_savdo %} checked {% endif %}>
                                        <label>B2B Savdo</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_bugungi_amaliyotlar" {% if use.is_bugungi_amaliyotlar %} checked {% endif %}>
                                        <label>Bugungi Amaliyotlar</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Inventarizatsiya Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'inventarizatsiya')">
                                    <div class="section-title">Inventarizatsiya</div>
                                </div>
                                <div class="subsection" id="inventarizatsiya">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_reviziya" {% if use.is_reviziya %} checked {% endif %}>
                                        <label>Reviziya</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_reviziya_tarixi" {% if use.is_reviziya_tarixi %} checked {% endif %}>
                                        <label>Tarix</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Hamkorlar Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'hamkorlar')">
                                    <div class="section-title">Hamkorlar</div>
                                </div>
                                <div class="subsection" id="hamkorlar">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_yetkazib_beruvchilar" {% if use.is_yetkazib_beruvchilar %} checked {% endif %}>
                                        <label>Yetkazib Beruvchilar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_mijozlar_tahlili" {% if use.is_mijozlar_tahlili %} checked {% endif %}>
                                        <label>Mijozlar Tahlili</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_mijozlar_qarzdorligi" {% if use.is_mijozlar_qarzdorligi %} checked {% endif %}>
                                        <label>Mijozlar Qarzdorligi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_turli_shaxs" {% if use.is_turli_shaxs %} checked {% endif %}>
                                        <label>Turli shaxslar</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Ombor Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'ombor')">
                                    <div class="section-title">Ombor</div>
                                </div>
                                <div class="subsection" id="ombor">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_ombor_boshkaruvi_ombor" {% if use.is_ombor_boshkaruvi_ombor %} checked {% endif %}>
                                        <label>Ombor</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_ombor_boshkaruvi_qabul" {% if use.is_ombor_boshkaruvi_qabul %} checked {% endif %}>
                                        <label>Ombor Qabul</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_ombor_boshkaruvi_ombordan_analiz" {% if use.is_ombor_boshkaruvi_ombordan_analiz %} checked {% endif %}>
                                        <label>Omborda mahsulotlar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_maxsutlo_tahlili" {% if use.is_maxsutlo_tahlili %} checked {% endif %}>
                                        <label>Maxsulot Tahlili</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_maxsulot_tahriri" {% if use.is_maxsulot_tahriri %} checked {% endif %}>
                                        <label>Maxsulot Tahriri</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_maxsulot_boshkaruvi" {% if use.is_maxsulot_boshkaruvi %} checked {% endif %}>
                                        <label>Maxsulotlar Boshqaruvi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_ot_prixod" {% if use.is_ot_prixod %} checked {% endif %}>
                                        <label>Kirim</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_ot_tarix" {% if use.is_ot_tarix %} checked {% endif %}>
                                        <label>Kirim Tarix</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_hisobdan_chiqish" {% if use.is_hisobdan_chiqish %} checked {% endif %}>
                                        <label>Hisobdan chiqarish</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_hisobdan_tarix" {% if use.is_hisobdan_tarix %} checked {% endif %}>
                                        <label>Hisobdan chiqarish Tarix</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_qabul" {% if use.is_qabul %} checked {% endif %}>
                                        <label>Qabul</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_taminotchi_qaytuv" {% if use.is_taminotchi_qaytuv %} checked {% endif %}>
                                        <label>Taminotchi Qaytuv</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_taminotchi_qaytuv_tarix" {% if use.is_taminotchi_qaytuv_tarix %} checked {% endif %}>
                                        <label>Taminotchi Tarix</label>
                                    </div>

                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_product_filail_zero" {% if use.is_product_filail_zero %} checked {% endif %}>
                                        <label>Ohirlagan maxsulotlar</label>
                                    </div>

                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Moliya Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'moliya')">
                                    <div class="section-title">Moliya</div>
                                </div>
                                <div class="subsection" id="moliya">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kassa" {% if use.is_kassa %} checked {% endif %}>
                                        <label>Kassa</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_filial_kassalar" {% if use.is_filial_kassalar %} checked {% endif %}>
                                        <label>Kassa Filial</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_analiz_xarajatlar" {% if use.is_analiz_xarajatlar %} checked {% endif %}>
                                        <label>Analiz Harajatlar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kassa_tarixi" {% if use.is_kassa_tarixi %} checked {% endif %}>
                                        <label>Kassa Tarixi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_balans_hisobi" {% if use.is_balans_hisobi %} checked {% endif %}>
                                        <label>Balans Hisobi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_fin_hisoboti" {% if use.is_fin_hisoboti %} checked {% endif %}>
                                        <label>Fin Hisoboti</label>
                                    </div>
                                    <!-- <div class="subsection-item">
                                        <input type="checkbox" name="is_xodim_kunlik" {% if use.is_xodim_kunlik %} checked {% endif %}>
                                        <label>Kunlik ishchi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_xodim_oylik" {% if use.is_xodim_oylik %} checked {% endif %}>
                                        <label>Oylik ishchi</label>
                                    </div> -->
                                    <!-- <div class="subsection-item">
                                        <input type="checkbox" name="is_xodim_mobile" {% if use.is_xodim_mobile %} checked {% endif %}>
                                        <label>Mobile ishchi</label>
                                    </div> -->
                                    <!-- <div class="subsection-item">
                                        <input type="checkbox" name="is_xodim_call_center" {% if use.is_xodim_call_center %} checked {% endif %}>
                                        <label>Call center</label>
                                    </div> -->
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kassa_tasdiklanmagan" {% if use.is_kassa_tasdiklanmagan %} checked {% endif %}>
                                        <label>Smenalar tarixi</label>
                                    </div>

                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_close_cash" {% if use.is_close_cash %} checked {% endif %}>
                                        <label>Kassani yopish</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Hisobot Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'hisobot')">
                                    <div class="section-title">Hisobot</div>
                                </div>
                                <div class="subsection" id="hisobot">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_reyting_maxsulotlar" {% if use.is_reyting_maxsulotlar %} checked {% endif %}>
                                        <label>Maxsulotlar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_reyting_mijozlar" {% if use.is_reyting_mijozlar %} checked {% endif %}>
                                        <label>Mijozlar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_reyting_yetkazib_beruvchilar" {% if use.is_reyting_yetkazib_beruvchilar %} checked {% endif %}>
                                        <label>Yetkazib Beruvchilar</label>
                                    </div>
                                </div>
                                
                                <div class="divider"></div>
                                
                                <!-- Sozlamalar Section -->
                                <div class="section-header">
                                    <input type="checkbox" class="section-checkbox" onchange="toggleSubsection(this, 'sozlamalar')">
                                    <div class="section-title">Sozlamalar</div>
                                </div>
                                <div class="subsection" id="sozlamalar">
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_measurement_type" {% if use.is_measurement_type %} checked {% endif %}>
                                        <label>O'lchov turlari</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_price_type" {% if use.is_price_type %} checked {% endif %}>
                                        <label>Narx Turi</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_filial_list" {% if use.is_filial_list %} checked {% endif %}>
                                        <label>Filial</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_nds" {% if use.is_nds %} checked {% endif %}>
                                        <label>NDS</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kadrlar" {% if use.is_kadrlar %} checked {% endif %}>
                                        <label>Foydalanuvchilar</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_valyuta" {% if use.is_valyuta %} checked {% endif %}>
                                        <label>Valyuta</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kassa_merge" {% if use.is_kassa_merge %} checked {% endif %}>
                                        <label>Kassa Biriktirish</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_kassa_new" {% if use.is_kassa_new %} checked {% endif %}>
                                        <label>Kassa</label>
                                    </div>
                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_money_circulation" {% if use.is_money_circulation %} checked {% endif %}>
                                        <label>Pul Muomalasi</label>
                                    </div>

                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_last_seen" {% if use.is_last_seen %} checked {% endif %}>
                                        <label>Oxirgi ko'rilgan</label>
                                    </div>

                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_debtor_type" {% if use.is_debtor_type %} checked {% endif %}>
                                        <label>Mijoz Turi</label>
                                    </div>


                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_region" {% if use.is_region %} checked {% endif %}>
                                        <label>Mintaqa</label>
                                    </div>


                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_teritory" {% if use.is_teritory %} checked {% endif %}>
                                        <label>Hudud</label>
                                    </div>

                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_groups" {% if use.is_groups %} checked {% endif %}>
                                        <label>Maxsulot guruhi</label>
                                    </div>


                                    <div class="subsection-item">
                                        <input type="checkbox" name="is_rounding_settings" {% if use.is_rounding_settings %} checked {% endif %}>
                                        <label>Savdo yahlitlash</label>
                                    </div>
                                </div>
                                
                                <div class="text-right mt-4">
                                    <button class="btn btn-success" type="submit">Saqlash</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block js %}
<script>
    // Bo'lim checkboxi bosilganda ostidagi barcha checkboxlarni belgilash/olib tashlash
    function toggleSubsection(mainCheckbox, sectionId) {
        const subsection = document.getElementById(sectionId);
        const checkboxes = subsection.querySelectorAll('input[type="checkbox"]');
        
        checkboxes.forEach(checkbox => {
            checkbox.checked = mainCheckbox.checked;
        });
    }

    // Har bir subsection checkboxi o'zgarganda asosiy bo'lim checkboxini tekshirish
    document.addEventListener('DOMContentLoaded', function() {
        const sections = [
            'dashboard', 'sotuvlar', 'inventarizatsiya', 
            'hamkorlar', 'ombor', 'moliya', 
            'hisobot', 'sozlamalar'
        ];
        
        sections.forEach(sectionId => {
            const subsection = document.getElementById(sectionId);
            if (subsection) {
                const checkboxes = subsection.querySelectorAll('input[type="checkbox"]');
                const sectionCheckbox = document.querySelector(`.section-checkbox[onchange*="${sectionId}"]`);
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                        const someChecked = Array.from(checkboxes).some(cb => cb.checked);
                        
                        sectionCheckbox.checked = allChecked;
                        sectionCheckbox.indeterminate = someChecked && !allChecked;
                    });
                });
            }
        });
    });
</script>
{% endblock js %}